<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Foundations of Algebra – Course Portal</title>
    <link rel="stylesheet" href="styles.css" />
    <!-- Font Awesome for subtle icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      integrity="sha512-pp0YcYxyXbbvrr9fOVc72BEUwd8MoyI2l85tA3q7W+WfwKcF32IVPrxKP7JXef+SJ+wWqgArql/0uv7L00glxg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <body>
    <header class="navbar">
      <div class="brand">Foundations of Algebra</div>
      <nav class="nav-links">
        <button data-section="home">Home</button>
        <button data-section="assignments">Assignments</button>
        <button data-section="discussions">Discussion</button>
        <button data-section="resources">Resources</button>
        <button data-section="exams">Exams</button>
        <!-- Removed Scores button as grade statistics page is deprecated -->
        <!-- Messages and Notifications nav buttons removed: notifications accessed via bell icon -->
        <button data-section="admin" id="adminNav" style="display: none">Admin</button>
      </nav>
      <!-- Notifications bell and user info -->
      <div class="header-right">
        <div class="notifications" id="notificationsBell" style="display:none; position:relative; cursor:pointer; margin-right:1rem;">
          <!-- Only show the bell icon and badge; remove text label to avoid duplication with Notifications page -->
          <i class="fa-solid fa-bell"></i>
          <span id="notificationCount" class="badge" style="position:absolute; top:-6px; right:-6px; background-color:#ff3b30; color:#fff; border-radius:50%; padding:2px 4px; font-size:0.65rem; display:none;"></span>
        </div>
        <div class="user-info" id="userInfo"></div>
      </div>
    </header>

    <!-- Notification panel removed; notifications are viewed on dedicated page -->

    <!-- Login Modal / Form (hidden until invoked) -->
    <!-- Login Section -->
    <section id="login-section" class="page hidden">
      <h2>Login</h2>
      <form id="loginForm" class="form">
        <label for="loginEmail">Email</label>
        <input type="email" id="loginEmail" required />
        <label for="loginPassword">Password</label>
        <input type="password" id="loginPassword" required />
        <button type="submit" class="btn-blue">Login</button>
      </form>
      <p style="margin-top:0.5rem; font-size:0.85rem;">Don’t have an account? <a href="#" id="showRegisterLink">Register here</a></p>
      <p style="margin-top:0.5rem; font-size:0.85rem;">Forgot your password? <a href="#" id="showResetRequestLink">Request a reset</a></p>
    </section>

    <!-- Registration Section -->
    <section id="register-section" class="page hidden">
      <h2>Register</h2>
      <form id="registerForm" class="form">
        <label for="regName">Name</label>
        <input type="text" id="regName" required />
        <label for="regEmail">Email</label>
        <input type="email" id="regEmail" required />
        <label for="regPassword">Password</label>
        <input type="password" id="regPassword" required />
        <label for="regRole">Role</label>
        <select id="regRole">
          <option value="student">Student</option>
          <option value="admin">Admin/TA</option>
        </select>
        <div id="regStudentFields">
          <label for="regStudentId">Student ID</label>
          <input type="text" id="regStudentId" />
          <label for="regStudentNameZh">Chinese Name (中文姓名)</label>
          <input type="text" id="regStudentNameZh" />
        </div>
        <div id="regTaField" class="hidden">
          <label for="regInvite">TA Invitation Code</label>
          <input type="text" id="regInvite" />
        </div>
        <button type="submit" class="btn-blue">Create Account</button>
      </form>
      <p style="margin-top:0.5rem; font-size:0.85rem;">Already have an account? <a href="#" id="showLoginLink">Back to Login</a></p>
    </section>

    <!-- Request Password Reset Section -->
    <section id="reset-request-section" class="page hidden">
      <h2>Forgot Password</h2>
      <form id="resetRequestForm" class="form">
        <label for="resetRequestEmail">Enter your email</label>
        <input type="email" id="resetRequestEmail" required />
        <button type="submit" class="btn-blue">Request Reset</button>
      </form>
      <p style="margin-top:0.5rem; font-size:0.85rem;">Remembered your password? <a href="#" id="backToLoginFromResetRequest">Back to Login</a></p>
    </section>

    <!-- Reset Password Section -->
    <section id="reset-password-section" class="page hidden">
      <h2>Reset Password</h2>
      <form id="resetPasswordForm" class="form">
        <label for="resetPasswordEmail">Email</label>
        <input type="email" id="resetPasswordEmail" required />
        <!-- Hidden token field; populated automatically from the reset link. -->
        <input type="hidden" id="resetTokenInput" />
        <label for="newPassword">New Password</label>
        <input type="password" id="newPassword" required />
        <button type="submit" class="btn-blue">Reset Password</button>
      </form>
      <p style="margin-top:0.5rem; font-size:0.85rem;">Back to login? <a href="#" id="backToLoginFromReset">Back to Login</a></p>
    </section>


    <!-- Home Section -->
    <section id="home-section" class="page hidden">
      <h2>Course Information &amp; Announcements</h2>
      <!-- Overall grade dashboard: hidden until data loaded -->
      <div id="homeOverall" class="card" style="margin-bottom:1rem; display:none;"></div>
      <!-- Course info wrapped in a card for consistent styling -->
      <div id="courseInfo" class="card">
        <p>This course introduces the foundations of modern algebra, including group theory, ring theory, and linear algebra. Throughout the semester we will explore algebraic structures and their applications.</p>
      </div>
      <div class="announcement-panel">
        <h3>Announcements</h3>
        <ul id="announcementsList" class="list"></ul>
        <div id="announcementFormContainer" class="hidden">
          <h4>Post New Announcement</h4>
          <form id="announcementForm" class="form">
            <label for="announcementTitle">Title</label>
            <input type="text" id="announcementTitle" required />
            <label for="announcementContent">Content</label>
            <textarea id="announcementContent" rows="3" required></textarea>
            <button type="submit" class="btn-blue">Post Announcement</button>
          </form>
        </div>
      </div>

      <!-- Recent Assignments Section -->
      <div class="recent-assignments-panel">
        <h3>Recent Assignments</h3>
        <div id="homeAssignmentsList" class="assignment-home-list"></div>
      </div>

      <!-- Recent Discussions on Home Page -->
      <div class="discussion-home-panel">
        <h3>Recent Discussions</h3>
        <div id="homeThreadsList" class="discussion-list"></div>
      </div>
    </section>

    <!-- Assignments Section -->
    <section id="assignments-section" class="page hidden">
      <h2>Assignments</h2>
      <div id="assignmentsList" class="assignment-list"></div>
      <div id="newAssignmentContainer" class="hidden">
        <h3>Create New Assignment</h3>
        <form id="newAssignmentForm" class="form">
          <label for="newAssignmentTitle">Title</label>
          <input type="text" id="newAssignmentTitle" required />
          <label for="newAssignmentDescription">Description (Markdown &amp; LaTeX)</label>
          <textarea id="newAssignmentDescription" rows="3" placeholder="Optional description in Markdown..."></textarea>
          <label for="newAssignmentFile">Assignment PDF</label>
          <input type="file" id="newAssignmentFile" accept="application/pdf" required />
          <label for="newAssignmentDue">Due Date</label>
          <input type="datetime-local" id="newAssignmentDue" required />
          <button type="submit" class="btn-blue">Create Assignment</button>
        </form>
      </div>
    </section>

    <!-- Grade Modal (hidden until needed) -->
    <div id="gradeModal" class="modal hidden">
      <div class="modal-content" id="gradeModalContent">
        <!-- dynamic content inserted here -->
      </div>
    </div>

    <!-- Assignment Grades Page: lists graded and ungraded submissions for a single assignment -->
    <section id="assignment-grades-section" class="page hidden">
      <h2 id="gradesPageTitle">Grade Submissions</h2>
      <div id="gradesList"></div>
    </section>

    <!-- Grade Submission Page: view and grade an individual submission on its own page -->
    <section id="grade-submission-section" class="page hidden">
      <button id="backToGradesBtn" class="btn-blue" style="margin-bottom: 1rem;">&larr; Back</button>
      <h2 id="gradeSubmissionTitle">Grade Submission</h2>
      <div id="gradeSubmissionContent"></div>
    </section>

    <!-- PDF Preview Modal (for previewing any PDF with pdf.js) -->
    <div id="pdfModal" class="modal hidden">
      <div class="modal-content" id="pdfModalContent"></div>
    </div>

    <!-- Resources Section -->
    <section id="resources-section" class="page hidden">
      <h2>Course Resources</h2>
      <div id="resourcesList" class="resource-list"></div>
      <div id="newResourceContainer" class="hidden">
        <h3>Upload Resource</h3>
        <form id="newResourceForm" class="form" enctype="multipart/form-data">
          <label for="resourceTitle">Title</label>
          <input type="text" id="resourceTitle" required />
          <label for="resourceFile">File (PDF or other)</label>
          <input type="file" id="resourceFile" accept="application/pdf,application/zip,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" required />
          <button type="submit" class="btn-blue">Upload</button>
        </form>
      </div>
    </section>

    <!-- Exams Section -->
    <section id="exams-section" class="page hidden">
      <h2>Exams &amp; Assessments</h2>
      <div id="examsList" class="exam-list"></div>
      <div id="newExamContainer" class="hidden">
        <h3>Create Exam Notification</h3>
        <form id="newExamForm" class="form">
          <label for="examTitle">Title</label>
          <input type="text" id="examTitle" required />
          <label for="examDate">Date</label>
          <input type="datetime-local" id="examDate" required />
          <label for="examDescription">Description</label>
          <textarea id="examDescription" rows="3" required></textarea>
          <button type="submit" class="btn-blue">Create Exam</button>
        </form>
      </div>
    </section>

    <!-- Admin Section (placeholder for extended controls) -->
    <section id="admin-section" class="page hidden">
      <h2>Administration</h2>
      <div class="admin-nav">
        <button data-admin-section="info">Course Info</button>
        <button data-admin-section="announcements">Announcements</button>
        <button data-admin-section="assignments">Assignments</button>
        <button data-admin-section="resources">Resources</button>
        <button data-admin-section="exams">Exams</button>
        <button data-admin-section="discussions">Discussions</button>
        <button data-admin-section="students">Students</button>
        <button data-admin-section="taCode">TA Code</button>
        <button data-admin-section="resets">Password Resets</button>
      </div>
      <!-- TA Invitation Code section moved to its own admin tab -->
      <!-- Admin subsections (hidden by default) -->
      <div id="admin-info" class="admin-subsection hidden">
        <h3>Edit Course Information</h3>
        <form id="courseInfoForm" class="form">
          <label for="courseInfoTextarea">Course Info (Markdown &amp; LaTeX allowed)</label>
          <textarea id="courseInfoTextarea" rows="5" required></textarea>
          <button type="submit" class="btn-blue">Update Information</button>
        </form>
      </div>
      <div id="admin-announcements" class="admin-subsection hidden">
        <h3>Post Announcement</h3>
        <form id="adminAnnouncementForm" class="form">
          <label for="adminAnnouncementTitle">Title</label>
          <input type="text" id="adminAnnouncementTitle" required />
          <label for="adminAnnouncementContent">Content (Markdown &amp; LaTeX)</label>
          <textarea id="adminAnnouncementContent" rows="3" required></textarea>
          <button type="submit" class="btn-blue">Publish Announcement</button>
        </form>
      </div>
      <div id="admin-assignments" class="admin-subsection hidden">
        <h3>Create Assignment</h3>
        <form id="adminAssignmentForm" class="form" enctype="multipart/form-data">
          <label for="adminAssignmentTitle">Title</label>
          <input type="text" id="adminAssignmentTitle" required />
          <label for="adminAssignmentDescription">Description (Markdown &amp; LaTeX)</label>
          <textarea id="adminAssignmentDescription" rows="3" placeholder="Optional description in Markdown..."></textarea>
          <label for="adminAssignmentFile">Assignment PDF</label>
          <input type="file" id="adminAssignmentFile" accept="application/pdf" required />
          <label for="adminAssignmentDue">Due Date</label>
          <input type="datetime-local" id="adminAssignmentDue" required />
          <button type="submit" class="btn-blue">Create Assignment</button>
        </form>
      </div>
      <div id="admin-resources" class="admin-subsection hidden">
        <h3>Upload Resource</h3>
        <form id="adminResourceForm" class="form" enctype="multipart/form-data">
          <label for="adminResourceTitle">Title</label>
          <input type="text" id="adminResourceTitle" required />
          <label for="adminResourceFile">File (PDF or other)</label>
          <input type="file" id="adminResourceFile" accept="application/pdf,application/zip,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" required />
          <button type="submit" class="btn-blue">Upload Resource</button>
        </form>
      </div>
      <div id="admin-exams" class="admin-subsection hidden">
        <h3>Create Exam Notification</h3>
        <form id="adminExamForm" class="form">
          <label for="adminExamTitle">Title</label>
          <input type="text" id="adminExamTitle" required />
          <label for="adminExamDate">Date</label>
          <input type="datetime-local" id="adminExamDate" required />
          <label for="adminExamDescription">Description</label>
          <textarea id="adminExamDescription" rows="3" required></textarea>
          <button type="submit" class="btn-blue">Create Exam</button>
        </form>
      </div>
      <div id="admin-discussions" class="admin-subsection hidden">
        <h3>Manage Discussions</h3>
        <div id="adminThreadList"></div>
      </div>
      <div id="admin-students" class="admin-subsection hidden">
        <h3>Pending Registrations</h3>
        <div id="pendingStudentsList"></div>
        <h3 style="margin-top:1.5rem;">Student Management</h3>
        <div id="studentsList"></div>
        <form id="muteStudentForm" class="form" style="margin-top:1rem; max-width:300px;">
          <label for="muteStudentId">Student ID</label>
          <input type="text" id="muteStudentId" placeholder="Enter student ID" />
          <div style="display:flex; gap:0.5rem; margin-top:0.5rem;">
            <button id="muteBtn" type="button" class="btn-yellow">Mute</button>
            <button id="unmuteBtn" type="button" class="btn-green">Unmute</button>
          </div>
        </form>
        <!-- Export grades button -->
        <div style="margin-top:1.5rem;">
          <button id="exportGradesBtn" type="button" class="btn-blue">Export Grades (CSV)</button>
        </div>
      </div>

      <!-- TA Code subsection -->
      <div id="admin-taCode" class="admin-subsection hidden">
        <h3>TA Invitation Code</h3>
        <p>Current code: <span id="currentTaCode"></span></p>
        <form id="inviteCodeForm" class="form" style="max-width:300px;">
          <label for="taCodeInput">Set New Code</label>
          <input type="text" id="taCodeInput" required />
          <button type="submit" class="btn-blue">Update Code</button>
        </form>
      </div>

      <!-- Password Reset Requests subsection -->
      <div id="admin-resets" class="admin-subsection hidden">
        <h3>Password Reset Requests</h3>
        <div id="resetRequestsList"></div>
      </div>
    </section>

    <!-- Discussions Section -->
    <section id="discussions-section" class="page hidden">
      <h2>Discussion Forum</h2>
      <div id="discussionList" class="discussion-list"></div>
      <div id="newThreadContainer" class="hidden">
        <div class="form-card">
          <h3>New Thread</h3>
          <form id="newThreadForm" class="form">
          <label for="threadTitle">Title</label>
          <input type="text" id="threadTitle" required />
          <label for="threadContent">Content (Markdown &amp; LaTeX)</label>
          <textarea id="threadContent" rows="4" required></textarea>
          <label for="threadFile">Attachment (optional)</label>
          <input type="file" id="threadFile" accept="application/pdf,application/msword,application/vnd.openxmlformats-officedocument.*,.png,.jpg,.jpeg" />
            <button type="submit" class="btn-blue">Post Thread</button>
          </form>
        </div>
      </div>
    </section>

    <!-- Thread Modal for viewing a thread and comments -->
    <div id="threadModal" class="modal hidden">
      <div class="modal-content" id="threadModalContent"></div>
    </div>

    <!-- Thread Page (replaces modal for dedicated view) -->
    <section id="thread-page-section" class="page hidden">
      <div id="threadPageContent"></div>
    </section>

    <!-- Assignment Detail Page for students/admin -->
    <section id="assignment-page-section" class="page hidden">
      <div id="assignmentPageContent"></div>
    </section>

    <!-- Scores Section removed as per new requirements (grade statistics page canceled) -->

    <!-- Notifications Section: list all notifications with details -->
    <section id="notifications-section" class="page hidden">
      <h2>Notifications</h2>
      <div id="notificationsList"></div>
    </section>

    <!-- Messages section removed as private messaging has been disabled -->

    <!-- Include marked for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Include KaTeX for LaTeX rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"></script>
    <!-- Include pdf.js for richer PDF preview (multi‑page and zoom). We use a version from cdnjs. -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <!-- Include SweetAlert2 for prettier alerts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Main script should load after markdown and math libraries -->
    <script src="main.js"></script>
  </body>
</html>