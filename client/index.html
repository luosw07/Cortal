<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Foundations of Algebra – Course Portal</title>
    <link rel="stylesheet" href="styles.css" />
    <!-- Font Awesome for subtle icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      integrity="sha512-pp0YcYxyXbbvrr9fOVc72BEUwd8MoyI2l85tA3q7W+WfwKcF32IVPrxKP7JXef+SJ+wWqgArql/0uv7L00glxg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <body>
    <header class="navbar">
      <div class="brand">Foundations of Algebra</div>
      <nav class="nav-links">
        <button data-section="home">Home</button>
        <button data-section="assignments">Assignments</button>
        <button data-section="discussions">Discussion</button>
        <button data-section="resources">Resources</button>
        <button data-section="exams">Exams</button>
        <button data-section="scores">Scores</button>
        <button data-section="messages">Messages</button>
        <button data-section="admin" id="adminNav" style="display: none">Admin</button>
      </nav>
      <!-- Notifications bell and user info -->
      <div class="header-right">
        <div class="notifications" id="notificationsBell" style="display:none; position:relative; cursor:pointer; margin-right:1rem;">
          <i class="fa-solid fa-bell"></i>
          <span class="notif-label" style="margin-left:0.25rem; font-size:0.85rem;">Notifications</span>
          <span id="notificationCount" class="badge" style="position:absolute; top:-6px; right:-6px; background-color:#ff3b30; color:#fff; border-radius:50%; padding:2px 4px; font-size:0.65rem; display:none;"></span>
        </div>
        <div class="user-info" id="userInfo"></div>
      </div>
    </header>

    <!-- Notification panel (hidden by default) -->
    <div id="notificationPanel" class="notification-panel hidden"></div>

    <!-- Login Modal / Form (hidden until invoked) -->
    <section id="login-section" class="page hidden">
      <h2>Login / Register</h2>
      <form id="loginForm" class="form">
        <label for="nameInput">Name</label>
        <input type="text" id="nameInput" required />
        <label for="emailInput">Email</label>
        <input type="email" id="emailInput" required />
        <label for="roleSelect">Role</label>
        <select id="roleSelect">
          <option value="student">Student</option>
          <option value="admin">Admin/TA</option>
        </select>
        <!-- Student specific fields -->
        <div id="studentFields">
          <label for="studentIdInput">Student ID</label>
          <input type="text" id="studentIdInput" />
          <label for="studentNameZhInput">Chinese Name (中文姓名)</label>
          <input type="text" id="studentNameZhInput" />
        </div>
        <!-- Admin invitation code field -->
        <div id="adminFields" class="hidden">
          <label for="inviteCodeInput">TA Invitation Code</label>
          <input type="text" id="inviteCodeInput" />
        </div>
        <button type="submit" class="primary-btn">Login / Register</button>
      </form>
    </section>


    <!-- Home Section -->
    <section id="home-section" class="page hidden">
      <h2>Course Information &amp; Announcements</h2>
      <div id="courseInfo">
        <p>This course introduces the foundations of modern algebra, including group theory, ring theory, and linear algebra. Throughout the semester we will explore algebraic structures and their applications.</p>
      </div>
      <div class="announcement-panel">
        <h3>Announcements</h3>
        <ul id="announcementsList" class="list"></ul>
        <div id="announcementFormContainer" class="hidden">
          <h4>Post New Announcement</h4>
          <form id="announcementForm" class="form">
            <label for="announcementTitle">Title</label>
            <input type="text" id="announcementTitle" required />
            <label for="announcementContent">Content</label>
            <textarea id="announcementContent" rows="3" required></textarea>
            <button type="submit" class="primary-btn">Post Announcement</button>
          </form>
        </div>
      </div>

      <!-- Recent Discussions on Home Page -->
      <div class="discussion-home-panel">
        <h3>Recent Discussions</h3>
        <div id="homeThreadsList" class="discussion-list"></div>
      </div>
    </section>

    <!-- Assignments Section -->
    <section id="assignments-section" class="page hidden">
      <h2>Assignments</h2>
      <div id="assignmentsList" class="assignment-list"></div>
      <div id="newAssignmentContainer" class="hidden">
        <h3>Create New Assignment</h3>
        <form id="newAssignmentForm" class="form">
          <label for="newAssignmentTitle">Title</label>
          <input type="text" id="newAssignmentTitle" required />
          <label for="newAssignmentDescription">Description (Markdown &amp; LaTeX)</label>
          <textarea id="newAssignmentDescription" rows="3" placeholder="Optional description in Markdown..."></textarea>
          <label for="newAssignmentFile">Assignment PDF</label>
          <input type="file" id="newAssignmentFile" accept="application/pdf" required />
          <label for="newAssignmentDue">Due Date</label>
          <input type="datetime-local" id="newAssignmentDue" required />
          <button type="submit" class="primary-btn">Create Assignment</button>
        </form>
      </div>
    </section>

    <!-- Grade Modal (hidden until needed) -->
    <div id="gradeModal" class="modal hidden">
      <div class="modal-content" id="gradeModalContent">
        <!-- dynamic content inserted here -->
      </div>
    </div>

    <!-- Resources Section -->
    <section id="resources-section" class="page hidden">
      <h2>Course Resources</h2>
      <div id="resourcesList" class="resource-list"></div>
      <div id="newResourceContainer" class="hidden">
        <h3>Upload Resource</h3>
        <form id="newResourceForm" class="form" enctype="multipart/form-data">
          <label for="resourceTitle">Title</label>
          <input type="text" id="resourceTitle" required />
          <label for="resourceFile">File (PDF or other)</label>
          <input type="file" id="resourceFile" accept="application/pdf,application/zip,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" required />
          <button type="submit" class="primary-btn">Upload</button>
        </form>
      </div>
    </section>

    <!-- Exams Section -->
    <section id="exams-section" class="page hidden">
      <h2>Exams &amp; Assessments</h2>
      <div id="examsList" class="exam-list"></div>
      <div id="newExamContainer" class="hidden">
        <h3>Create Exam Notification</h3>
        <form id="newExamForm" class="form">
          <label for="examTitle">Title</label>
          <input type="text" id="examTitle" required />
          <label for="examDate">Date</label>
          <input type="datetime-local" id="examDate" required />
          <label for="examDescription">Description</label>
          <textarea id="examDescription" rows="3" required></textarea>
          <button type="submit" class="primary-btn">Create Exam</button>
        </form>
      </div>
    </section>

    <!-- Admin Section (placeholder for extended controls) -->
    <section id="admin-section" class="page hidden">
      <h2>Administration</h2>
      <p>Use the navigation above to manage announcements, assignments, resources and exams. Only users with a valid TA invitation code can access these controls.</p>
      <div id="inviteCodeSetting" style="margin-top:1rem;">
        <h3>TA Invitation Code</h3>
        <p>Current code: <span id="currentTaCode"></span></p>
        <form id="inviteCodeForm" class="form" style="max-width:300px;">
          <label for="taCodeInput">Set New Code</label>
          <input type="text" id="taCodeInput" required />
          <button type="submit" class="primary-btn">Update Code</button>
        </form>
      </div>

      <!-- Consolidated management forms -->
      <div id="adminForms" style="margin-top:2rem; display:flex; flex-direction:column; gap:2rem;">
        <!-- Course information management -->
        <div class="admin-panel">
          <h3>Edit Course Information</h3>
          <form id="courseInfoForm" class="form">
            <label for="courseInfoTextarea">Course Info (Markdown &amp; LaTeX allowed)</label>
            <textarea id="courseInfoTextarea" rows="5" required></textarea>
            <button type="submit" class="primary-btn">Update Information</button>
          </form>
        </div>
        <!-- Announcement management -->
        <div class="admin-panel">
          <h3>Post Announcement</h3>
          <form id="adminAnnouncementForm" class="form">
            <label for="adminAnnouncementTitle">Title</label>
            <input type="text" id="adminAnnouncementTitle" required />
            <label for="adminAnnouncementContent">Content (Markdown &amp; LaTeX)</label>
            <textarea id="adminAnnouncementContent" rows="3" required></textarea>
            <button type="submit" class="primary-btn">Publish Announcement</button>
          </form>
        </div>
        <!-- Assignment management -->
        <div class="admin-panel">
          <h3>Create Assignment</h3>
          <form id="adminAssignmentForm" class="form" enctype="multipart/form-data">
            <label for="adminAssignmentTitle">Title</label>
            <input type="text" id="adminAssignmentTitle" required />
            <label for="adminAssignmentDescription">Description (Markdown &amp; LaTeX)</label>
            <textarea id="adminAssignmentDescription" rows="3" placeholder="Optional description in Markdown..."></textarea>
            <label for="adminAssignmentFile">Assignment PDF</label>
            <input type="file" id="adminAssignmentFile" accept="application/pdf" required />
            <label for="adminAssignmentDue">Due Date</label>
            <input type="datetime-local" id="adminAssignmentDue" required />
            <button type="submit" class="primary-btn">Create Assignment</button>
          </form>
        </div>
        <!-- Resource management -->
        <div class="admin-panel">
          <h3>Upload Resource</h3>
          <form id="adminResourceForm" class="form" enctype="multipart/form-data">
            <label for="adminResourceTitle">Title</label>
            <input type="text" id="adminResourceTitle" required />
            <label for="adminResourceFile">File (PDF or other)</label>
            <input type="file" id="adminResourceFile" accept="application/pdf,application/zip,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" required />
            <button type="submit" class="primary-btn">Upload Resource</button>
          </form>
        </div>
        <!-- Exam management -->
        <div class="admin-panel">
          <h3>Create Exam Notification</h3>
          <form id="adminExamForm" class="form">
            <label for="adminExamTitle">Title</label>
            <input type="text" id="adminExamTitle" required />
            <label for="adminExamDate">Date</label>
            <input type="datetime-local" id="adminExamDate" required />
            <label for="adminExamDescription">Description</label>
            <textarea id="adminExamDescription" rows="3" required></textarea>
            <button type="submit" class="primary-btn">Create Exam</button>
          </form>
        </div>
        <!-- Discussion moderation -->
        <div class="admin-panel">
          <h3>Manage Discussions</h3>
          <div id="adminThreadList"></div>
        </div>

        <!-- Pending student registrations -->
        <div class="admin-panel">
          <h3>Pending Student Registrations</h3>
          <div id="pendingStudentsList"></div>
        </div>

        <!-- Student management (mute/unmute) -->
        <div class="admin-panel">
          <h3>Student Management</h3>
          <div id="studentsList"></div>
          <form id="muteStudentForm" class="form" style="margin-top:1rem; max-width:300px;">
            <label for="muteStudentId">Student ID</label>
            <input type="text" id="muteStudentId" placeholder="Enter student ID" />
            <div style="display:flex; gap:0.5rem; margin-top:0.5rem;">
              <button id="muteBtn" type="button" class="secondary-btn">Mute</button>
              <button id="unmuteBtn" type="button" class="secondary-btn">Unmute</button>
            </div>
          </form>
        </div>
      </div>
    </section>

    <!-- Discussions Section -->
    <section id="discussions-section" class="page hidden">
      <h2>Discussion Forum</h2>
      <div id="discussionList" class="discussion-list"></div>
      <div id="newThreadContainer" class="hidden">
        <h3>New Thread</h3>
        <form id="newThreadForm" class="form">
          <label for="threadTitle">Title</label>
          <input type="text" id="threadTitle" required />
          <label for="threadContent">Content (Markdown &amp; LaTeX)</label>
          <textarea id="threadContent" rows="4" required></textarea>
          <label for="threadFile">Attachment (optional)</label>
          <input type="file" id="threadFile" accept="application/pdf,application/msword,application/vnd.openxmlformats-officedocument.*,.png,.jpg,.jpeg" />
          <button type="submit" class="primary-btn">Post Thread</button>
        </form>
      </div>
    </section>

    <!-- Thread Modal for viewing a thread and comments -->
    <div id="threadModal" class="modal hidden">
      <div class="modal-content" id="threadModalContent"></div>
    </div>

    <!-- Thread Page (replaces modal for dedicated view) -->
    <section id="thread-page-section" class="page hidden">
      <div id="threadPageContent"></div>
    </section>

    <!-- Assignment Detail Page for students/admin -->
    <section id="assignment-page-section" class="page hidden">
      <div id="assignmentPageContent"></div>
    </section>

    <!-- Scores Section: shows grade statistics and student dashboard -->
    <section id="scores-section" class="page hidden">
      <h2>Grades &amp; Statistics</h2>
      <div id="scoresContent"></div>
    </section>

    <!-- Messages Section: inbox and new message composer -->
    <section id="messages-section" class="page hidden">
      <h2>Private Messages</h2>
      <div id="messageList" class="message-list"></div>
      <div id="newMessageContainer" class="message-compose">
        <h3>Send a New Message</h3>
        <form id="newMessageForm" class="form">
          <label for="messageRecipient">Recipient Email</label>
          <input type="email" id="messageRecipient" required />
          <label for="messageSubject">Subject</label>
          <input type="text" id="messageSubject" required />
          <label for="messageContent">Message</label>
          <textarea id="messageContent" rows="4" required></textarea>
          <button type="submit" class="primary-btn">Send Message</button>
        </form>
      </div>
    </section>

    <!-- Include marked for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Include KaTeX for LaTeX rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"></script>
    <!-- Include pdf.js for richer PDF preview (multi‑page and zoom). We use a version from cdnjs. -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <!-- Main script should load after markdown and math libraries -->
    <script src="main.js"></script>
  </body>
</html>