# 代数基础课程门户

本仓库包含 **代数基础** 课程的动态网页门户。后端基于 **Express/Node.js**，前端使用轻量的原生 JavaScript，并参照 Apple 的人机界面指南（HIG）进行设计。
该门户允许教师发布公告与作业、管理课程资源和考试、主持讨论区、审阅并批改 PDF 提交文件，以及与学生进行私密交流。学生可以注册、浏览资料、提交 PDF 作业、参与论坛讨论并查看成绩。通知系统通过电子邮件和应用内铃铛图标提醒重要事件。

---

## 核心功能

* **公告发布** – 教师可发布课程公告。公告会通过电子邮件发送给注册用户，并在首页向访客展示。

* **带内联批改的作业系统** – 每份作业都有独立的详情页，包含三个面板：

  1. 基于 `pdf.js` 的多页 PDF 浏览器；
  2. 学生 PDF 提交区，带有精美的上传控件与文件预览；
  3. 批改面板，显示分数、评语及合并批注后的反馈文件下载链接。
     助教可直接在 PDF 上批注，并用 `pdf-lib` 将批注合并入文件中。

* **资源下载** – 教师可上传课程讲义、习题集及其他文件，学生可下载。文件存储在 `server/uploads/resources` 目录下。

* **考试通知** – 教师可添加考试信息（标题、时间、描述），在考试页面显示，并通知全体学生。

* **增强的注册与权限系统** –
  用户注册需设置 **密码**。
  学生须填写姓名、邮箱、学号及中文名。
  注册需 **管理员审批**；待审核学生可浏览网站但不能发帖或提交作业。
  助教通过邀请码（默认 `TA2025`）注册。
  密码使用 bcrypt 哈希，登录成功后服务器颁发 JWT 令牌，令牌需附在受保护的 API 请求中。

* **讨论区** – 用户可发起主题帖并使用 Markdown/LaTeX 及可选附件进行回复。
  每个主题有独立页面，按时间顺序显示主帖与回复。
  助教标有 “TA” 徽章，可归档或删除帖子与评论。
  管理员可按学号 **禁言** 学生，禁言期间无法发帖或提交作业。

* **成绩与统计** –
  **成绩**页面中，每份作业以卡片展示，进度条显示平均分及已批改数量。
  学生可快速对比全班水平，管理员可获得全局视图。

* **私信系统** – 用户可向任意邮箱地址发送私信。
  **消息**页面改为聊天界面：左侧为会话列表（带未读数徽章），右侧为彩色气泡式对话框。
  发送新消息会自动刷新会话，对方会收到邮件及应用内通知。

* **通知系统** – 提交作业、成绩发布、新公告、考试提醒、新私信等事件，都会通过邮件和应用内通知提醒。
  顶部铃铛图标显示未读数，点击可展开快速面板，主 **通知**页面按时间顺序列出全部记录，并标注已读状态。

* **管理面板** – 各管理功能分为多个标签页（课程信息、公告、作业、资源、考试、讨论、学生），避免单页过长。
  管理员可编辑课程信息、发布公告、创建作业/考试/资源、管理讨论、查看成绩统计、修改 TA 邀请码、审批注册、禁言/解禁学生。

* **Apple 风格设计** – 前端使用系统字体、浅色调、半透明面板与圆角卡片，界面从桌面到移动端均自适应。

---

## 本地开发

1. **安装前置环境** – 确保已安装 [Node.js](https://nodejs.org/)（版本 ≥ 14）和 npm。
2. **安装依赖**：

   ```bash
   cd course-portal
   npm install
   ```
3. **启动开发服务器**：

   ```bash
   npm run dev
   ```

   服务器默认运行在 **[http://localhost:3000](http://localhost:3000)**，后端修改会自动重载。
4. **首次注册** – 首次访问时需填写姓名、邮箱和角色。学生须提供学号及中文名。助教需输入有效邀请码（默认 `TA2025`）。学生注册后状态为 *待审核*。
5. **数据存储** – 演示环境数据存于内存数组中，重启服务器会清空。要持久化需接入数据库（如 PostgreSQL）。

---

## 部署指南

1. **准备环境** – 在服务器上安装 Node.js，并克隆或复制 `course-portal` 目录。
2. **配置邮件** – 当前使用 Nodemailer 的 *stream* 传输（输出到控制台），生产环境需配置 SMTP：

   ```js
   const transporter = nodemailer.createTransport({
     host: 'smtp.example.com',
     port: 587,
     secure: false,
     auth: {
       user: process.env.SMTP_USER,
       pass: process.env.SMTP_PASS,
     },
   });
   ```

   将 SMTP 凭证存储为环境变量，切勿写入源码。
3. **安装依赖**：

   ```bash
   cd course-portal
   npm install --production
   ```
4. **运行服务**：

   ```bash
   npm start
   ```

   或直接运行 `node server/index.js`。端口由 `PORT` 环境变量决定（默认 3000）。
5. **反向代理与 SSL** – 生产环境建议通过 Nginx/Apache 做反向代理和 HTTPS。
6. **持久化** – 接入数据库替换内存数组，并可将文件存储迁移至云存储。

---

## 额外功能建议

* **评分细则与结构化批改** – 为作业设定详细评分标准，确保一致性并帮助学生理解得分依据。
* **小组作业与互评** – 支持学生组队提交、互相批改，类似 Canvas 的小组与同伴评审功能。
* **日历集成** – 提供作业与考试日程的日历订阅（Outlook/Google）。
* **数据分析面板** – 可视化展示成绩分布、提交时间线、讨论活跃度等。
* **导出与备份** – 允许管理员导出成绩、论坛内容与资源为 CSV 或 PDF。

---

## 许可证

本项目基于 MIT License 开源发布。
